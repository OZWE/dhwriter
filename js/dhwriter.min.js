function initSignupForm(){$("#signupForm").validate({rules:{first_name:"required",last_name:"required",institution:"required",email:{required:!0,email:!0},password1:{required:!0,minlength:5},password2:{required:!0,minlength:5,equalTo:"#password1"}},messages:{firstname:"Please fill in your first name",lastname:"Please fill in your last name",institution:"Please fill in your institution",email:"Please enter a valid email address",password1:{required:"Please provide a password",minlength:"Your password must be at least 5 characters long"},password2:{required:"Please provide a password",minlength:"Your password must be at least 5 characters long",equalTo:"Please enter the same password as above"}}})}var kAutoSaveDelay=3e4;Aloha.ready(function(){Aloha.require(["PubSub","genericbutton/genericbutton-plugin"],function(e,t){function i(){var e=Aloha.getEditableById("canvas").getContents(),t=e.trim().replace(/<([^>]*)>/gi," ").replace(/\s+/gi," ").split(" ").length,n=$("#canvas cite>span").text().trim().replace(/<([^>]*)>/gi," ").replace(/\s+/gi," ").split(" ").length;$("#wordsCount").html(t-n);$("#wordsLimit").html("5000")}function s(){var e=Aloha.getEditableById("canvas");return $("#writer #container .toolbar .btn.nosave").length==0&&(e.isModified()||r)}function o(){var e;$("#exportReview").stop(!1,!0).fadeIn();e=Aloha.getEditableById("canvas");e.setUnmodified();r=!1}function u(){$("#metas>form input, #metas>form textarea, #metas>form select").unbind("input").bind("input change",function(){r=!0});$("#metas>form input[name=title]").unbind("input").bind("input",function(){$("#metas>header>h1").html($(this).val());$("#currentDocMenuItem>b").html($(this).val())});$("#fAuthors>div").first().children("input[type=text]").slice(0,2).unbind("input").bind("input",function(){$("#metas>header>h2").html($(this).parent().children("input[type=text]:eq(0)").val()+" "+$(this).parent().children("input[type=text]:eq(1)").val())});$("#fAuthors>div").each(function(){var e=$(this);$(this).find(".btn.delete").unbind("click touchdown").bind("click touchdown",function(){$.get("_.php",{f:"deleteAuthor",id:e.find('input[type="hidden"]').val()});e.slideUp(function(){$(this).remove()})})});$("#fAuthors").sortable({handle:".drag",containment:"parent",scroll:!0,update:function(){$.get("_.php?"+$("#fAuthors").sortable("serialize"),{f:"sort",t:"authors"})}})}function a(n){var r,i,u,a=Aloha.getEditableById("canvas");if(s()){o();r=$("<section/>");r.append(a.getContents());typeof window.XMLSerializer!="undefined"?i=(new XMLSerializer).serializeToString(r.get(0)):typeof xmlNode.xml!="undefined"&&(i=r.get(0).xml);if(save_url!==null){u=$("#metas>form").serializeArray();u.push({name:"html",value:i});$.post(save_url,u,function(r){if(r.error)$("#statusmessage").data("message")(r.error,"error",0);else{$("#statusmessage").data("message")("Saved");t.getButtons().save.enable(!1);$(".btn.save").html("Saved");n&&n()}e.pub("swordpushweb.saved")})}else{$("#statusmessage").data("message")("Saved");t.getButtons().save.enable(!1);$(".btn.save").html("Saved");n&&n()}}}var n,r=!1;t.getButtons().save.enable(!1);$(".btn.save").html("Saved");u();$("#metas>form #fAuthors .btn.add").bind("click touchdown",function(){var e=$("#metas>form #fAuthors>div").last(),t=e.clone();t.css({display:"none"}).find(".btn.delete").removeClass("hidden");e.after(t);$.get("_.php",{f:"addAuthor",paper_id:paper_id},function(e){var n;if(parseInt(e,10)>0){n=t.find('input[type="hidden"]').val();t.find('input[name="first_name'+n+'"]').attr("name","first_name"+e);t.find('input[name="last_name'+n+'"]').attr("name","last_name"+e);t.find('input[name="email'+n+'"]').attr("name","email"+e);t.find('input[name="affiliation'+n+'"]').attr("name","affiliation"+e);t.find("input").each(function(){$(this).val("")});t.find('input[type="hidden"]').val(e);t.slideDown()}});u()});$(".btn.login").bind("click touchdown",function(){$("#loginFull").fadeIn()});$("#loginFull>.close").bind("click touchdown",function(){$("#loginFull").fadeOut()});$("aside a.export").bind("click touchdown",function(e){var t,n;e.preventDefault();t="exporter.php?ext="+$(this).data("ext")+"&rev="+$(this).data("rev");n=$('<form action="'+t+'" method="post">'+'<textarea name="src" >'+Aloha.getEditableById("canvas").getContents()+"</textarea></form>");n.append($("#metas form>*").clone());n.submit()});e.sub("swordpushweb.save",function(e){a();e&&e.callback&&e.callback()});n=$("#statusmessage");n.data("message",function(e,t,r){var i,s;t=t||"info";r===undefined&&(r=1500);i=$("<div/>",{"class":t,text:e}).hide().appendTo(n).center().fadeIn(700);if(r>0)i.delay(r).fadeOut(800,function(){$(this).remove()});else{i.addClass("persistent-error");s=$("<i> </i>");i.append(s);s.on("click",function(e){$(e.target).off("click");i.remove()})}});Aloha.jQuery.get(body_url,function(e){var n=Aloha.jQuery("<div />").html(e),r=Aloha.jQuery("#canvas").html(n.find(">section> *"));if(r.length>0){r.find("#pDebug").remove();r.aloha().focus();MathJax.Hub.Configured();window.setInterval(a,kAutoSaveDelay);setInterval(function(){i();if(s()){$(".btn.save").html("Save");t.getButtons().save.enable(!0);$("#exportReview").stop(!1,!0).fadeOut()}},250)}$("#wait").fadeOut()})})});$(window).ready(function(){$("#metas>header, #container>footer>div>h2").bind("click touchdown",function(){$(this).closest("div").toggleClass("details",200)});$(".action.documents.delete").bind("click touchdown",function(e){e.preventDefault();e.stopPropagation();window.location.href="?delete_paper="+$("#metas>form input[name=paper_id]").val()});initSignupForm()});