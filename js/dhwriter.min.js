Aloha.ready(function(){Aloha.require(["PubSub","genericbutton/genericbutton-plugin"],function(e,t){function r(n){var r,i,s=Aloha.getEditableById("canvas");if(s.isModified()){s.setUnmodified();r=$("<body/>");r.append(s.getContents());typeof window.XMLSerializer!="undefined"?i=(new XMLSerializer).serializeToString(r.get(0)):typeof xmlNode.xml!="undefined"&&(i=r.get(0).xml);if(save_url!==null)$.post(save_url,{html:i},function(r){if(r.error)$("#statusmessage").data("message")(r.error,"error",0);else{$("#statusmessage").data("message")("Saved");t.getButtons().save.enable(!1);$(".btn.save").html("Saved");n&&n()}e.pub("swordpushweb.saved")});else{$("#statusmessage").data("message")("Saved");t.getButtons().save.enable(!1);$(".btn.save").html("Saved");n&&n()}}}var n;t.getButtons().save.enable(!1);$(".btn.save").html("Saved");e.sub("swordpushweb.save",function(e){r();e&&e.callback&&e.callback()});n=$("#statusmessage");n.data("message",function(e,t,r){var i,s;t=t||"info";r===undefined&&(r=1500);i=$("<div />",{"class":t,text:e}).hide().appendTo(n).center().fadeIn(700);if(r>0)i.delay(r).fadeOut(800,function(){$(this).remove()});else{i.addClass("persistent-error");s=$("<i> </i>");i.append(s);s.on("click",function(e){$(e.target).off("click");i.remove()})}});$("#statusmessage").data("message")("Loading preview...");Aloha.jQuery.get(body_url,function(e){var n=Aloha.jQuery("<div />").html(e),i=Aloha.jQuery("#canvas").html(n.find("> *"));i.find("#pDebug").remove();i.aloha().focus();MathJax.Hub.Configured();window.setInterval(r,3e4);setInterval(function(){var e=Aloha.getEditableById("canvas");if(e.isModified()){$(".btn.save").html("Save");t.getButtons().save.enable(!0)}},250);Aloha.jQuery("#statusmessage").data("message")("Preview loaded")})})});