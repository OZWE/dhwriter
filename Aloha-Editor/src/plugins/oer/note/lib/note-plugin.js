(function(){define(["aloha","aloha/plugin","jquery","aloha/ephemera","ui/ui","ui/button","semanticblock/semanticblock-plugin","css!note/css/note-plugin.css"],function(e,t,n,r,i,s,o){var u=n('<span class="type-container dropdown aloha-ephemera">\n    <span class="type btn-link" data-toggle="dropdown"></span>\n    <ul class="dropdown-menu">\n    </ul>\n</span>'),a={},f=[];return t.create("note",{defaults:[{label:"Note",cls:"note",hasTitle:!0}],getLabel:function(e){var t,n,r;for(n=0,r=f.length;n<r;n++){t=f[n];if(e.is(t.selector))return t.label}},activate:function(e){var t,i,s,o=this;e.attr("data-format-whitelist",'["p"]');r.markAttr(e,"data-format-whitelist");i=e.children(".title");i.attr("hover-placeholder","Add a title (optional)");i.aloha();s="Note";t=e.contents().not(i);n.each(f,function(t,r){var i;if(e.is(r.selector)){s=r.label;i=u.clone();if(f.length>1)n.each(f,function(t,r){var s=n('<li><span class="btn-link"></span></li>');s.appendTo(i.find(".dropdown-menu"));s=s.children("span");s.text(r.label);i.find(".type").on("click",function(){return n.each(f,function(t,r){if(e.attr("data-type")===r.type)return i.find(".dropdown-menu li").each(function(e,t){n(t).removeClass("checked");if(n(t).children("span").text()===r.label)return n(t).addClass("checked")})})});return s.on("click",function(){var t,s;if(r.hasTitle){if(!e.children(".title")[0]){t=n("<"+(r.titleTagName||"span")+" class='title'></"+(r.titleTagName||"span"));e.append(t);t.aloha()}}else e.children(".title").remove();r.type?e.attr("data-type",r.type):e.removeAttr("data-type");i.find(".type").text(r.label);for(s in a)e.removeClass(s);return e.addClass(r.cls)})});else{i.find(".dropdown-menu").remove();i.find(".type").removeAttr("data-toggle")}i.find(".type").text(r.label);return i.prependTo(e)}});return t=n("<div>").addClass("body").addClass("aloha-block-dropzone").attr("placeholder","Type the text of your "+s.toLowerCase()+" here.").appendTo(e).aloha().append(t)},deactivate:function(e){var t,r,i,s,o,u,a,l=this,c=e.children(".body"),h=c.contents();for(u=0,a=h.length;u<a;u++){i=h[u];i.nodeName==="#text"&&(i.data.trim().length?n(i).wrap("<p></p>"):i.remove())}c=c.contents();e.children(".body").remove();s=void 0;o="span";n.each(f,function(t,n){if(e.is(n.selector)){s=n.hasTitle||!1;return o=n.titleTagName||o}});if(s||s===void 0){r=e.children(".title");t=n("<"+o+' class="title"></'+o+">");if(r.length){t.append(r.contents());r.remove()}t.prependTo(e)}return e.append(c)},selector:".note",init:function(){var e=this;f=this.settings;n.each(f,function(e,t){var r,u=t.cls||function(){throw"BUG Invalid configuration of note plugin. cls required!"}(),f=t.type,l=!!t.hasTitle,c=t.label||function(){throw"BUG Invalid configuration of note plugin. label required!"}(),h=t.tagName||"div",p=t.titleTagName||"div";f?t.selector="."+u+"[data-type='"+f+"']":t.selector="."+u+":not([data-type])";a[u]=!0;r=n("<"+h+"></"+h);r.addClass(u);f&&r.attr("data-type",f);l&&r.append("<"+p+" class='title'></"+p);i.adopt("insert-"+u+f,s,{click:function(){return o.insertAtCursor(r.clone())}});if("note"===u&&!f)return i.adopt("insertNote",s,{click:function(){return o.insertAtCursor(r.clone())}})});return o.register(this)}})})}).call(this);