(function(){define(["jquery","aloha","aloha/plugin","PubSub","ui/button"],function(e,t,n,r){var i,s,o=null,u=e("body"),a=function(e){var t=function(){function t(){}t.prototype.show=function(){return u.find(".action."+e).removeClass("hidden")};t.prototype.hide=function(){};t.prototype.setActive=function(t){t||u.find(".action."+e).removeClass("active");if(t)return u.find(".action."+e).addClass("active")};t.prototype.setState=function(e){return this.setActive(e)};t.prototype.enable=function(t){var n,r;t==null&&(t=!0);n=u.find(".action."+e);r=$.Event(t&&"enable-action"||"disable-action");n.trigger(r);if(r.isDefaultPrevented())return;return n.is(".btn")?t?n.removeAttr("disabled"):n.attr("disabled","disabled"):t?n.parent().removeClass("disabled"):n.parent().addClass("disabled")};t.prototype.disable=function(){return this.enable(!1)};t.prototype.setActiveButton=function(t,n){return console&&console.log(""+e+" TODO:SETACTIVEBUTTON:",t,n)};t.prototype.focus=function(t){return console&&console.log(""+e+" TODO:FOCUS:",t)};t.prototype.foreground=function(t){return console&&console.log(""+e+" TODO:FOREGROUND:",t)};t.prototype.flash=function(){var t,n,r,i=u.find(".action."+e),s=$.Event("flash-action");i.trigger(s);if(s.isDefaultPrevented())return;r=[];for(t=n=1;n<=6;t=n+=1)r.push(setTimeout(function(){return i.toggleClass("ui-flash")},200*t));return r};return t}();return new t},f={};t.bind("aloha-ready",function(){return e.each(f,function(n,r){var i=".action."+n;u.on("click",i,function(n){var i;n.preventDefault();t.activeEditable=t.activeEditable||o;i=e(n.target);if(!i.is(":disabled")&&!i.parent().is(".disabled")){this.element=this;return r.click.bind(this)(n)}});r.preview&&u.on("mouseenter",i,function(t){var n=e(t.target);if(!n.is(":disabled")&&!n.parent().is(".disabled"))return r.preview.bind(this)(t)});if(r.unpreview)return u.on("mouseleave",i,function(t){var n=e(t.target);if(!n.is(":disabled")&&!n.parent().is(".disabled"))return r.unpreview.bind(this)(t)})})});s={};i=function(e,t){var n,r,i=u.find(".headings ul");i.empty();for(r in e){n=e[r];i.append('<li><a href="#" class="action changeHeading" data-tagname="'+r+'">'+n+"</a></li>")}return u.find(".headings .currentHeading").text(s[t])};return n.create("toolbar",{defaults:{defaultFormat:"p",formats:{p:"Normal Text",h1:"Heading",h2:"Subheading",h3:"SubSubHeading",pre:"Code"}},init:function(){var n,a=this;s=this.settings.formats;e.extend(a.settings,this.defaults);n=function(n){var r,i,s,o,u,a;n.preventDefault();r=e(this);u=r.attr("data-tagname");a=t.Selection.getRangeObject();a.isCollapsed()&&GENTICS.Utils.Dom.extendToWord(a);t.Selection.changeMarkupOnSelection(t.jQuery("<"+u+"></"+u+">"));e(".currentHeading")[0].innerHTML=r[0].innerHTML;s=t.jQuery(a.getCommonAncestorContainer());i=t.jQuery(t.Selection.getRangeObject().getCommonAncestorContainer());i.addClass(s.attr("class"));o=$.Event();o.type="change-heading";o.target=i[0];return i.trigger(o)};u.on("click",".action.changeHeading",n);u.on("mousedown",".action",function(e){return e.stopPropagation()});t.bind("aloha-editable-activated",function(e,t){return o=t.editable});return r.sub("aloha.selection.context-change",function(t){var n,r,o,u,f=t.range.commonAncestorContainer,l=$(f).parents().andSelf(),c=l.filter(Object.keys(s).join(",")).first(),h=[];l.filter("[data-format-blacklist]").each(function(){return h+=e(this).data("formatBlacklist")});u=[];l.filter("[data-format-whitelist]").each(function(){return u+=e(this).data("formatWhitelist")});n=[];for(o in s){r=s[o];(!h.length||h.indexOf(o)===-1)&&(!u.length||u.indexOf(o)!==-1)&&(n[o]=r)}c.length?c=c.get(0).tagName.toLowerCase():c=a.settings.defaultFormat;return i(n,c)})},childVisible:function(e,t){var n=$.Event("aloha.toolbar.childvisible");n.component=e;n.visible=t;return r.pub(n.type,n)},childFocus:function(e){var t=$.Event("aloha.toolbar.childfocus");t.component=e;return r.pub(t.type,t)},childForeground:function(e){var t=$.Event("aloha.toolbar.childforeground");t.component=e;return r.pub(t.type,t)},adopt:function(e,t,n){var i=$.Event("aloha.toolbar.adopt");$.extend(i,{params:{slot:e,type:t,settings:n},component:null});r.pub(i.type,i);if(i.isDefaultPrevented()){i.component.adoptParent(toolbar);return i.component}f[e]=n;return a(e)},toString:function(){return"toolbar"}})})}).call(this);