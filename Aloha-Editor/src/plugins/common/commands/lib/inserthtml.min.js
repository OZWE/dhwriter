define(["aloha/core","jquery","aloha/command","aloha/selection","util/dom","aloha/contenthandlermanager","aloha/console"],function(e,t,n,r,i,s,o){"use strict";n.register("inserthtml",{action:function(n,r){function c(e){var n,s=t(e);if(!i.insertIntoDOM(s,r,a,!1)){n=s.contents();(i.isBlockLevelElement(e)||i.isListElement(e))&&c(t("<br/>").get(0));for(u=n.length-1;u>=0;--u)c(n[u])}}var u,a=t(i.getEditingHostOf(r.startContainer)),f=r.commonAncestorContainer,l=[];n=s.handleContent(n,{contenthandler:e.settings.contentHandler.insertHtml});if(typeof n=="string")n=t("<div>"+n+"</div>");else{if(!(n instanceof t))throw"INVALID_VALUE_ERR";n=t("<div>").append(n)}l=n.contents();i.removeRange(r);for(u=l.length-1;u>=0;--u)c(l[u]);l.length>0?r=i.setCursorAfter(l.get(l.length-1)):r.select();i.doCleanup({merge:!0,removeempty:!0},r,f);try{r.select()}catch(h){o.warn("Error:",h)}}})});